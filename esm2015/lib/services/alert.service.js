import { HttpResponseBase } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { DialogType, MessageSeverity, Utilities } from '@polpware/ngx-appkit-contracts-alpha';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
export class AlertService {
    constructor() {
        this.messages = new Subject();
        this.dialogs = new Subject();
    }
    showDialog(message, type, okCallback, cancelCallback, okLabel, cancelLabel, defaultValue) {
        if (!type) {
            type = DialogType.alert;
        }
        this.dialogs.next({ message, type, okCallback, cancelCallback, okLabel, cancelLabel, defaultValue });
    }
    showMessage(data, separatorOrDetail, severity) {
        if (!severity) {
            severity = MessageSeverity.default;
        }
        if (data instanceof HttpResponseBase) {
            data = Utilities.getHttpResponseMessages(data);
            separatorOrDetail = Utilities.captionAndMessageSeparator;
        }
        if (data instanceof Array) {
            for (const message of data) {
                const msgObject = Utilities.splitInTwo(message, separatorOrDetail);
                this.showMessageHelper(msgObject.firstPart, msgObject.secondPart, severity, false);
            }
        }
        else {
            this.showMessageHelper(data, separatorOrDetail, severity, false);
        }
    }
    showStickyMessage(data, separatorOrDetail, severity, error, onRemove) {
        if (!severity) {
            severity = MessageSeverity.default;
        }
        if (data instanceof HttpResponseBase) {
            data = Utilities.getHttpResponseMessages(data);
            separatorOrDetail = Utilities.captionAndMessageSeparator;
        }
        if (data instanceof Array) {
            for (const message of data) {
                const msgObject = Utilities.splitInTwo(message, separatorOrDetail);
                this.showMessageHelper(msgObject.firstPart, msgObject.secondPart, severity, true);
            }
        }
        else {
            if (error) {
                const msg = `Severity: "${MessageSeverity[severity]}", Summary: "${data}", Detail: "${separatorOrDetail}", Error: "${Utilities.safeStringify(error)}"`;
                switch (severity) {
                    case MessageSeverity.default:
                        this.logInfo(msg);
                        break;
                    case MessageSeverity.info:
                        this.logInfo(msg);
                        break;
                    case MessageSeverity.success:
                        this.logMessage(msg);
                        break;
                    case MessageSeverity.error:
                        this.logError(msg);
                        break;
                    case MessageSeverity.warn:
                        this.logWarning(msg);
                        break;
                    case MessageSeverity.wait:
                        this.logTrace(msg);
                        break;
                }
            }
            this.showMessageHelper(data, separatorOrDetail, severity, true, onRemove);
        }
    }
    showMessageHelper(summary, detail, severity, isSticky, onRemove) {
        const alertCommand = {
            operation: isSticky ? 'add_sticky' : 'add',
            message: { severity, summary, detail },
            onRemove
        };
        this.messages.next(alertCommand);
    }
    resetStickyMessage() {
        this.messages.next({ operation: 'clear' });
    }
    startLoadingMessage(message = 'Loading...', caption = '') {
        clearTimeout(this.loadingMessageTimeoutId);
        this.loadingMessageTimeoutId = setTimeout(() => {
            this.showStickyMessage(caption, message, MessageSeverity.wait);
        }, 1000);
    }
    stopLoadingMessage() {
        clearTimeout(this.loadingMessageTimeoutId);
        this.resetStickyMessage();
    }
    logDebug(msg) {
        console.debug(msg);
    }
    logError(msg) {
        console.error(msg);
    }
    logInfo(msg) {
        console.info(msg);
    }
    logMessage(msg) {
        console.log(msg);
    }
    logTrace(msg) {
        console.trace(msg);
    }
    logWarning(msg) {
        console.warn(msg);
    }
    getDialogEvent() {
        return this.dialogs.asObservable();
    }
    getMessageEvent() {
        return this.messages.asObservable();
    }
}
/** @nocollapse */ AlertService.ɵfac = function AlertService_Factory(t) { return new (t || AlertService)(); };
/** @nocollapse */ AlertService.ɵprov = i0.ɵɵdefineInjectable({ token: AlertService, factory: AlertService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AlertService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], null, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb2xwd2FyZS9uZ3gtYXBwa2l0LXNlcnZpY2VzLWFscGhhLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2FsZXJ0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQTZCLFVBQVUsRUFBeUIsZUFBZSxFQUFFLFNBQVMsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ2hKLE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7O0FBSzNDLE1BQU0sT0FBTyxZQUFZO0lBSHpCO1FBSVksYUFBUSxHQUFHLElBQUksT0FBTyxFQUFnQixDQUFDO1FBQ3ZDLFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBZSxDQUFDO0tBbUtoRDtJQTFKRyxVQUFVLENBQUMsT0FBZSxFQUFFLElBQWlCLEVBQUUsVUFBK0IsRUFBRSxjQUEwQixFQUFFLE9BQWdCLEVBQUUsV0FBb0IsRUFBRSxZQUFxQjtRQUVySyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsSUFBSSxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUM7U0FDM0I7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLGNBQWMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDekcsQ0FBQztJQVFELFdBQVcsQ0FBQyxJQUFTLEVBQUUsaUJBQTBCLEVBQUUsUUFBMEI7UUFFekUsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNYLFFBQVEsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDO1NBQ3RDO1FBRUQsSUFBSSxJQUFJLFlBQVksZ0JBQWdCLEVBQUU7WUFDbEMsSUFBSSxH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QVEsQ0FBQyxHQUFHO1FBQ1IsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRUQsVUFBVSxDQUFDLEdBQUc7UUFDVixPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxjQUFjO1FBQ1YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxlQUFlO1FBQ1gsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3hDLENBQUM7OzJGQXBLUSxZQUFZO3VFQUFaLFlBQVksV0FBWixZQUFZLG1CQUZULE1BQU07a0RBRVQsWUFBWTtjQUh4QixVQUFVO2VBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwUmVzcG9uc2VCYXNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWxlcnRDb21tYW5kLCBBbGVydERpYWxvZywgRGlhbG9nVHlwZSwgSUFsZXJ0U2VydmljZUNvbnRyYWN0LCBNZXNzYWdlU2V2ZXJpdHksIFV0aWxpdGllcyB9IGZyb20gJ0Bwb2xwd2FyZS9uZ3gtYXBwa2l0LWNvbnRyYWN0cy1hbHBoYSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQWxlcnRTZXJ2aWNlIGltcGxlbWVudHMgSUFsZXJ0U2VydmljZUNvbnRyYWN0IHtcbiAgICBwcml2YXRlIG1lc3NhZ2VzID0gbmV3IFN1YmplY3Q8QWxlcnRDb21tYW5kPigpO1xuICAgIHByaXZhdGUgZGlhbG9ncyA9IG5ldyBTdWJqZWN0PEFsZXJ0RGlhbG9nPigpO1xuXG4gICAgcHJpdmF0ZSBsb2FkaW5nTWVzc2FnZVRpbWVvdXRJZDogYW55O1xuXG5cblxuICAgIHNob3dEaWFsb2cobWVzc2FnZTogc3RyaW5nKTtcbiAgICBzaG93RGlhbG9nKG1lc3NhZ2U6IHN0cmluZywgdHlwZTogRGlhbG9nVHlwZSwgb2tDYWxsYmFjazogKHZhbD86IGFueSkgPT4gYW55KTtcbiAgICBzaG93RGlhbG9nKG1lc3NhZ2U6IHN0cmluZywgdHlwZTogRGlhbG9nVHlwZSwgb2tDYWxsYmFjaz86ICh2YWw/OiBhbnkpID0+IGFueSwgY2FuY2VsQ2FsbGJhY2s/OiAoKSA9PiBhbnksIG9rTGFiZWw/OiBzdHJpbmcsIGNhbmNlbExhYmVsPzogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBzdHJpbmcpO1xuICAgIHNob3dEaWFsb2cobWVzc2FnZTogc3RyaW5nLCB0eXBlPzogRGlhbG9nVHlwZSwgb2tDYWxsYmFjaz86ICh2YWw/OiBhbnkpID0+IGFueSwgY2FuY2VsQ2FsbGJhY2s/OiAoKSA9PiBhbnksIG9rTGFiZWw/OiBzdHJpbmcsIGNhbmNlbExhYmVsPzogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBzdHJpbmcpIHtcblxuICAgICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgICAgIHR5cGUgPSBEaWFsb2dUeXBlLmFsZXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5kaWFsb2dzLm5leHQoeyBtZXNzYWdlLCB0eXBlLCBva0NhbGxiYWNrLCBjYW5jZWxDYWxsYmFjaywgb2tMYWJlbCwgY2FuY2VsTGFiZWwsIGRlZmF1bHRWYWx1ZSB9KTtcbiAgICB9XG5cblxuXG4gICAgc2hvd01lc3NhZ2Uoc3VtbWFyeTogc3RyaW5nKTtcbiAgICBzaG93TWVzc2FnZShzdW1tYXJ5OiBzdHJpbmcsIGRldGFpbDogc3RyaW5nLCBzZXZlcml0eTogTWVzc2FnZVNldmVyaXR5KTtcbiAgICBzaG93TWVzc2FnZShzdW1tYXJ5QW5kRGV0YWlsczogc3RyaW5nW10sIHN1bW1hcnlBbmREZXRhaWxzU2VwYXJhdG9yOiBzdHJpbmcsIHNldmVyaXR5OiBNZXNzYWdlU2V2ZXJpdHkpO1xuICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2VCYXNlLCBpZ25vcmVWYWx1ZV91c2VOdWxsOiBzdHJpbmcsIHNldmVyaXR5OiBNZXNzYWdlU2V2ZXJpdHkpO1xuICAgIHNob3dNZXNzYWdlKGRhdGE6IGFueSwgc2VwYXJhdG9yT3JEZXRhaWw/OiBzdHJpbmcsIHNldmVyaXR5PzogTWVzc2FnZVNldmVyaXR5KSB7XG5cbiAgICAgICAgaWYgKCFzZXZlcml0eSkge1xuICAgICAgICAgICAgc2V2ZXJpdHkgPSBNZXNzYWdlU2V2ZXJpdHkuZGVmYXVsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgSHR0cFJlc3BvbnNlQmFzZSkge1xuICAgICAgICAgICAgZGF0YSA9IFV0aWxpdGllcy5nZXRIdHRwUmVzcG9uc2VNZXNzYWdlcyhkYXRhKTtcbiAgICAgICAgICAgIHNlcGFyYXRvck9yRGV0YWlsID0gVXRpbGl0aWVzLmNhcHRpb25BbmRNZXNzYWdlU2VwYXJhdG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtc2dPYmplY3QgPSBVdGlsaXRpZXMuc3BsaXRJblR3byhtZXNzYWdlLCBzZXBhcmF0b3JPckRldGFpbCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNob3dNZXNzYWdlSGVscGVyKG1zZ09iamVjdC5maXJzdFBhcnQsIG1zZ09iamVjdC5zZWNvbmRQYXJ0LCBzZXZlcml0eSwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaG93TWVzc2FnZUhlbHBlcihkYXRhLCBzZXBhcmF0b3JPckRldGFpbCwgc2V2ZXJpdHksIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgc2hvd1N0aWNreU1lc3NhZ2Uoc3VtbWFyeTogc3RyaW5nKTtcbiAgICBzaG93U3RpY2t5TWVzc2FnZShzdW1tYXJ5OiBzdHJpbmcsIGRldGFpbDogc3RyaW5nLCBzZXZlcml0eTogTWVzc2FnZVNldmVyaXR5LCBlcnJvcj86IGFueSk7XG4gICAgc2hvd1N0aWNreU1lc3NhZ2Uoc3VtbWFyeTogc3RyaW5nLCBkZXRhaWw6IHN0cmluZywgc2V2ZXJpdHk6IE1lc3NhZ2VTZXZlcml0eSwgZXJyb3I/OiBhbnksIG9uUmVtb3ZlPzogKCkgPT4gYW55KTtcbiAgICBzaG93U3RpY2t5TWVzc2FnZShzdW1tYXJ5QW5kRGV0YWlsczogc3RyaW5nW10sIHN1bW1hcnlBbmREZXRhaWxzU2VwYXJhdG9yOiBzdHJpbmcsIHNldmVyaXR5OiBNZXNzYWdlU2V2ZXJpdHkpO1xuICAgIHNob3dTdGlja3lNZXNzYWdlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2VCYXNlLCBpZ25vcmVWYWx1ZV91c2VOdWxsOiBzdHJpbmcsIHNldmVyaXR5OiBNZXNzYWdlU2V2ZXJpdHkpO1xuICAgIHNob3dTdGlja3lNZXNzYWdlKGRhdGE6IHN0cmluZyB8IHN0cmluZ1tdIHwgSHR0cFJlc3BvbnNlQmFzZSwgc2VwYXJhdG9yT3JEZXRhaWw/OiBzdHJpbmcsIHNldmVyaXR5PzogTWVzc2FnZVNldmVyaXR5LCBlcnJvcj86IGFueSwgb25SZW1vdmU/OiAoKSA9PiBhbnkpIHtcblxuICAgICAgICBpZiAoIXNldmVyaXR5KSB7XG4gICAgICAgICAgICBzZXZlcml0eSA9IE1lc3NhZ2VTZXZlcml0eS5kZWZhdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2VCYXNlKSB7XG4gICAgICAgICAgICBkYXRhID0gVXRpbGl0aWVzLmdldEh0dHBSZXNwb25zZU1lc3NhZ2VzKGRhdGEpO1xuICAgICAgICAgICAgc2VwYXJhdG9yT3JEZXRhaWwgPSBVdGlsaXRpZXMuY2FwdGlvbkFuZE1lc3NhZ2VTZXBhcmF0b3I7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbXNnT2JqZWN0ID0gVXRpbGl0aWVzLnNwbGl0SW5Ud28obWVzc2FnZSwgc2VwYXJhdG9yT3JEZXRhaWwpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TWVzc2FnZUhlbHBlcihtc2dPYmplY3QuZmlyc3RQYXJ0LCBtc2dPYmplY3Quc2Vjb25kUGFydCwgc2V2ZXJpdHksIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBTZXZlcml0eTogXCIke01lc3NhZ2VTZXZlcml0eVtzZXZlcml0eV19XCIsIFN1bW1hcnk6IFwiJHtkYXRhfVwiLCBEZXRhaWw6IFwiJHtzZXBhcmF0b3JPckRldGFpbH1cIiwgRXJyb3I6IFwiJHtVdGlsaXRpZXMuc2FmZVN0cmluZ2lmeShlcnJvcil9XCJgO1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzZXZlcml0eSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VTZXZlcml0eS5kZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dJbmZvKG1zZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBNZXNzYWdlU2V2ZXJpdHkuaW5mbzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nSW5mbyhtc2cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgTWVzc2FnZVNldmVyaXR5LnN1Y2Nlc3M6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ01lc3NhZ2UobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VTZXZlcml0eS5lcnJvcjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nRXJyb3IobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VTZXZlcml0eS53YXJuOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dXYXJuaW5nKG1zZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBNZXNzYWdlU2V2ZXJpdHkud2FpdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nVHJhY2UobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zaG93TWVzc2FnZUhlbHBlcihkYXRhLCBzZXBhcmF0b3JPckRldGFpbCwgc2V2ZXJpdHksIHRydWUsIG9uUmVtb3ZlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd01lc3NhZ2VIZWxwZXIoc3VtbWFyeTogc3RyaW5nLCBkZXRhaWw6IHN0cmluZywgc2V2ZXJpdHk6IE1lc3NhZ2VTZXZlcml0eSwgaXNTdGlja3k6IGJvb2xlYW4sIG9uUmVtb3ZlPzogKCkgPT4gYW55KSB7XG5cbiAgICAgICAgY29uc3QgYWxlcnRDb21tYW5kOiBBbGVydENvbW1hbmQgPSB7XG4gICAgICAgICAgICBvcGVyYXRpb246IGlzU3RpY2t5ID8gJ2FkZF9zdGlja3knIDogJ2FkZCcsXG4gICAgICAgICAgICBtZXNzYWdlOiB7IHNldmVyaXR5LCBzdW1tYXJ5LCBkZXRhaWwgfSxcbiAgICAgICAgICAgIG9uUmVtb3ZlXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5tZXNzYWdlcy5uZXh0KGFsZXJ0Q29tbWFuZCk7XG4gICAgfVxuXG4gICAgcmVzZXRTdGlja3lNZXNzYWdlKCkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzLm5leHQoeyBvcGVyYXRpb246ICdjbGVhcicgfSk7XG4gICAgfVxuXG4gICAgc3RhcnRMb2FkaW5nTWVzc2FnZShtZXNzYWdlID0gJ0xvYWRpbmcuLi4nLCBjYXB0aW9uID0gJycpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMubG9hZGluZ01lc3NhZ2VUaW1lb3V0SWQpO1xuXG4gICAgICAgIHRoaXMubG9hZGluZ01lc3NhZ2VUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1N0aWNreU1lc3NhZ2UoY2FwdGlvbiwgbWVzc2FnZSwgTWVzc2FnZVNldmVyaXR5LndhaXQpO1xuICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG5cbiAgICBzdG9wTG9hZGluZ01lc3NhZ2UoKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmxvYWRpbmdNZXNzYWdlVGltZW91dElkKTtcbiAgICAgICAgdGhpcy5yZXNldFN0aWNreU1lc3NhZ2UoKTtcbiAgICB9XG5cblxuXG4gICAgbG9nRGVidWcobXNnKSB7XG4gICAgICAgIGNvbnNvbGUuZGVidWcobXNnKTtcbiAgICB9XG5cbiAgICBsb2dFcnJvcihtc2cpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihtc2cpO1xuICAgIH1cblxuICAgIGxvZ0luZm8obXNnKSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhtc2cpO1xuICAgIH1cblxuICAgIGxvZ01lc3NhZ2UobXNnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKG1zZyk7XG4gICAgfVxuXG4gICAgbG9nVHJhY2UobXNnKSB7XG4gICAgICAgIGNvbnNvbGUudHJhY2UobXNnKTtcbiAgICB9XG5cbiAgICBsb2dXYXJuaW5nKG1zZykge1xuICAgICAgICBjb25zb2xlLndhcm4obXNnKTtcbiAgICB9XG5cbiAgICBnZXREaWFsb2dFdmVudCgpOiBPYnNlcnZhYmxlPEFsZXJ0RGlhbG9nPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpYWxvZ3MuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgZ2V0TWVzc2FnZUV2ZW50KCk6IE9ic2VydmFibGU8QWxlcnRDb21tYW5kPiB7XG4gICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLmFzT2JzZXJ2YWJsZSgpO1xuICAgIH1cbn1cblxuIl19